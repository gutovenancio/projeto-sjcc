<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Perfil â€“ SJCC</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<main class="container">

  
  <section class="top-row">
    
    <div class="top-left">
      
      <div class="top-grid" aria-label="Resumo">
        <div class="mini-stat">
          <div class="mini-icon">ðŸ“°</div>
          <div class="mini-value" id="read-articles-value">0</div>
          <div class="mini-label">notÃ­cias lidas</div>
        </div>
        <div class="mini-stat">
          <div class="mini-icon">ðŸ”¥</div>
          <div class="mini-value" id="streak-value">0</div>
          <div class="mini-label">dias de streak</div>
        </div>
        <div class="mini-stat">
          <div class="mini-icon">ðŸ”—</div>
          <div class="mini-value" id="metricReferrals">0</div>
          <div class="mini-label">indicaÃ§Ãµes</div>
        </div>
      </div>

      
      <section class="level-card" aria-label="NÃ­vel e Pontos">
        <div class="level-header">
          <span id="levelLabel">NÃ­vel 1</span>
          <strong class="points-strong" id="userPointsHeader">0</strong>
        </div>

        <div class="level-progress">
          <div class="level-bar-bg">
            <div class="level-bar-fill" id="levelBar" style="width:0%"></div>
          </div>
          <div class="level-legend">
            <span id="currentVsNext">0/0 pontos</span>
            <span id="nextLevelHint">Chegue em 0 pontos para conseguir o nÃ­vel 2</span>
          </div>
        </div>
      </section>

      <div class="actions-area">
      <button id="read-article-button" class="action-button">Li um Artigo!</button>
      <p id="status-message" class="status-message"></p>
      </div>

      <div class="history-btn-wrapper">
        <button class="history-btn" type="button">Ver histÃ³rico</button>
      </div>
    </div>

   
    <aside class="user-panel" aria-label="UsuÃ¡rio">
      <img src="Foto de Perfil.png" alt="Avatar" class="user-avatar" />
      <div class="user-info">
        <strong class="user-name" id="userName">Lucas Oliveira</strong>
        <div class="user-email" id="userEmail">lucasoliveira@email.com</div>
        <div class="user-prefs" id="userPrefs">
          <span>PolÃ­tica</span><span>Economia</span><span>CiÃªncia</span>
        </div>
      </div>
    </aside>
  </section>


  <section class="content-grid">

    
    <div class="panel">
      <div class="panel-header">Ofertas para vocÃª</div>
      <ul class="rewards-list" id="rewardsList">
       
        <li class="reward" data-price-brl="30">
          <div class="reward-info">
            <img src="assets/rewards/Smiles.png" class="reward-logo" alt="">
            <div>
              <h4>Milhas no Smiles</h4>
              <p>1000 milhas para vocÃª utilizar</p>
            </div>
          </div>
          <div class="reward-cta">
            <span class="cost">â€”</span>
            <span class="badge status"></span>
            <button class="redeem-btn" type="button" disabled>Resgatar</button>
          </div>
        </li>

        <li class="reward" data-price-brl="25">
          <div class="reward-info">
            <img src="assets/rewards/Caneca JC.png" class="reward-logo" alt="">
            <div>
              <h4>Caneca do JC</h4>
              <p>Personalizada com o seu nome</p>
            </div>
          </div>
          <div class="reward-cta">
            <span class="cost">â€”</span>
            <span class="badge status"></span>
            <button class="redeem-btn" type="button" disabled>Resgatar</button>
          </div>
        </li>

        <li class="reward" data-price-brl="15">
          <div class="reward-info">
            <img src="assets/rewards/e-book jc.png" class="reward-logo" alt="">
            <div>
              <h4>E-book JC</h4>
              <p>ConteÃºdo exclusivo sobre economia</p>
            </div>
          </div>
          <div class="reward-cta">
            <span class="cost">â€”</span>
            <span class="badge status"></span>
            <button class="redeem-btn" type="button" disabled>Resgatar</button>
          </div>
        </li>

      
        <li class="reward" data-price-brl="200">
          <div class="reward-info">
            <img src="assets/rewards/Netflix.png" class="reward-logo" alt="">
            <div>
              <h4>Voucher de R$ 200</h4>
              <p>Vale para parceiros selecionados</p>
            </div>
          </div>
          <div class="reward-cta">
            <span class="cost">â€”</span>
            <span class="badge status"></span>
            <button class="redeem-btn" type="button" disabled>Resgatar</button>
          </div>
        </li>
      </ul>

      <p class="more-link">
        <a href="#">Ver outras recompensas</a>
      </p>
    </div>


    <div class="panel">
      <div class="panel-header">Top Ranking</div>
      <ol class="ranking-list">
        <li><span class="pos">1</span> Ana Carolina Santos <b>100 ðŸ”¥</b></li>
        <li><span class="pos">2</span> Ricardo Mendes <b>89 ðŸ”¥</b></li>
        <li><span class="pos">3</span> Maria Julia Costa <b>63 ðŸ”¥</b></li>
        <li><span class="pos">4</span> Lucas Oliveira <b>50 ðŸ”¥</b></li>
        <li><span class="pos">5</span> Leila Soares <b>49 ðŸ”¥</b></li>
      </ol>
    </div>
  </section>
</main>

<script>

    const USER_ID = 1; 
    const API_URL = 'http://localhost:3000';

    const streakValueElement = document.getElementById('streak-value');
    const readArticlesValueElement = document.getElementById('read-articles-value');
    const readArticleButton = document.getElementById('read-article-button');
    const statusMessageElement = document.getElementById('status-message');

         /* FunÃ§Ã£o para buscar os dados do streak e de leituras na API e atualizar a pÃ¡gina.*/
        async function fetchUserStats() {
            try {
                const response = await fetch(`${API_URL}/streak/${USER_ID}`);
                
                if (response.ok) {
                    const statsData = await response.json();
                    
                    streakValueElement.textContent = statsData.current_streak;
                    readArticlesValueElement.textContent = statsData.totalReads;

                } else {
                    streakValueElement.textContent = 0;
                    readArticlesValueElement.textContent = 0;
                }

            } catch (error) {
                console.error('Erro ao buscar estatÃ­sticas:', error);
                statusMessageElement.textContent = 'Erro ao carregar dados.';
                streakValueElement.textContent = 0;
                readArticlesValueElement.textContent = 0;
            }
        }

    async function incrementStreak() {
        statusMessageElement.textContent = 'Registrando leitura...';
        try {
            const response = await fetch(`${API_URL}/streak/increment`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    userId: USER_ID,
                    articleId: `artigo-lido-em-${new Date().toISOString()}`
                }),
            });

            const result = await response.json();

            if (response.ok) {
                streakValueElement.textContent = result.current_streak;
                readArticlesValueElement.textContent = result.totalReads;
                statusMessageElement.textContent = result.status;
            } else {
                statusMessageElement.textContent = `Erro: ${result.error}`;
            }

        } catch (error) {
            console.error('Erro ao registrar leitura:', error);
            statusMessageElement.textContent = 'NÃ£o foi possÃ­vel conectar Ã  API.';
        }
    }
    
    document.addEventListener('DOMContentLoaded', fetchUserStats);
    readArticleButton.addEventListener('click', incrementStreak);
    const REFERRALS   = 5;
    const USER_POINTS = 2350; 
    const POINTS_PER_BRL = 20; 

    document.getElementById('metricReferrals').textContent = REFERRALS;

    function pointsForLevel(level){
      if (level <= 1) return 0;
      return 50 * Math.pow(2, level - 2);
    }

    function calculateLevel(totalPoints){
      let level = 1;
      while (totalPoints >= pointsForLevel(level + 1)) level++;
      return level;
    }

    const USER_LEVEL = calculateLevel(USER_POINTS);
    const PREV_REQ   = pointsForLevel(USER_LEVEL);
    const NEXT_REQ   = pointsForLevel(USER_LEVEL + 1);
    const CURR_IN_LV = USER_POINTS - PREV_REQ;
    const GAP_LV     = Math.max(1, NEXT_REQ - PREV_REQ);
    const PCT        = Math.max(0, Math.min(100, Math.round((CURR_IN_LV / GAP_LV) * 100)));

    document.getElementById('userPointsHeader').textContent = USER_POINTS.toLocaleString('pt-BR');
    document.getElementById('levelLabel').textContent       = `NÃ­vel ${USER_LEVEL}`;
    document.getElementById('levelBar').style.width         = PCT + '%';
    document.getElementById('currentVsNext').textContent    = `${CURR_IN_LV}/${GAP_LV} pontos`;
    document.getElementById('nextLevelHint').textContent    = `Chegue em ${NEXT_REQ} pontos para conseguir o nÃ­vel ${USER_LEVEL + 1}`;

    document.querySelectorAll('#rewardsList .reward').forEach(item => {
      const priceBRL = Number(item.getAttribute('data-price-brl') || 0);
      const costPts  = Math.round(priceBRL * POINTS_PER_BRL);
      const costEl   = item.querySelector('.cost');
      const statusEl = item.querySelector('.status');
      const btn      = item.querySelector('.redeem-btn');

      costEl.textContent = `${costPts} pts`;

      if (USER_POINTS >= costPts) {
        item.classList.add('can-redeem');
        statusEl.textContent = 'DisponÃ­vel';
        btn.disabled = false;
      } else {
        item.classList.add('locked');
        statusEl.textContent = `Faltam ${costPts - USER_POINTS} pts`;
        btn.disabled = true;
      }
    });

</script>
</body>
</html>
